MASTER PLAN v4.1 ‚Äî same spine as your Dec 6 v4.0, but:
* Better ‚Äúwhat this is and why it‚Äôs special‚Äù‚Ä®
* Includes CRM, onboarding wizard, A2P automation, industry packs, SMS parser, tech hub, etc.‚Ä®
* Keeps your phase numbering so we don‚Äôt lose continuity‚Ä®
You can literally paste this into the new GPT as the canonical doc.

üß† MASTER PLAN v4.1 ‚Äî SERVICEPRO + CLEAN MACHINE ROOT TENANT
The Canonical Product + Technical Blueprint

0. What ServicePro Actually Is (Non-boring Version)
ServicePro is a ‚Äúdo-it-for-you‚Äù automation OS for service businesses, with Clean Machine Auto Detail (Tulsa) as the flagship root tenant.
Instead of ‚Äúyet another CRM / booking app‚Äù, it‚Äôs built around:
* Fast, low-friction onboarding
    * Setup Wizard that feels like a guided assistant, not 40 random settings pages‚Ä®
    * A2P 10DLC registration handled for the user (no ‚Äúwhat‚Äôs a campaign use case?‚Äù forms)‚Ä®
    * Phone number provisioning, porting wizard, and passthrough billing baked in‚Ä®
    * Weather-aware rescheduling logic out of the box for outdoor services‚Ä®
* A living, auto-updating CRM
    * SMS Parser + File Upload onboarding flow parses your old work phone‚Äôs SMS + calls‚Ä®
    * It auto-learns your:
        * Services‚Ä®
        * Pricing patterns‚Ä®
        * Tone and phrases‚Ä®
        * Edge-case handling‚Ä®
        * Customer history‚Ä®
    * It builds a proper live customer database: names, phones, emails, vehicles, history‚Ä®
    * That database powers mass campaigns, interval reminders, loyalty, and agent context‚Ä®
* AI-augmented communications that feel human and helpful
    * SMS agent that knows your services, service area, policies, tone, pricing logic‚Ä®
    * Web chat agent for your site with smart booking links & availability‚Ä®
    * Phone agents (IVR + voicemail capture + SMS followups)‚Ä®
    * All of it tuned to your real patterns, not generic ‚ÄúHow can I assist you today?‚Äù nonsense‚Ä®
* CRM + Scheduling + Tech Hub in one place
    * Full customer history: conversations, appointments, notes, loyalty points, referrals‚Ä®
    * Booking wizard with Maps-based service area and dynamic travel logic‚Ä®
    * Technician Hub: ‚Äúone page for the whole day‚Äù
        * Today‚Äôs jobs‚Ä®
        * One-tap ‚ÄúOn My Way‚Äù‚Ä®
        * One-click invoicing‚Ä®
        * Next-job routing‚Ä®
    * PWA / mobile experience so the tech can actually live in it all day‚Ä®
* Automations that normal humans can configure
    * Simple vs Advanced Mode for the dashboard‚Ä®
    * Library of prebuilt flows:
        * Missed call ‚Üí SMS‚Ä®
        * Bad weather ‚Üí reschedule‚Ä®
        * Interval reminders (maintenance details, seasonal services)‚Ä®
        * Win-back sequences, review requests, gift-card pushes‚Ä®
    * Industry packs that ship with:
        * Preconfigured services + pricing schemes‚Ä®
        * Realistic upsell flows‚Ä®
        * Polished SMS/email copy‚Ä®
        * Industry-aware agents‚Ä®
        * Pre-loaded campaigns‚Ä®
    * All editable, but they start good even if the user touches nothing.‚Ä®
* Tiered SaaS with gamified upsell & high transparency
    * Free tier with serious value and ‚Äúwow that‚Äôs included?!‚Äù energy‚Ä®
    * Pro / Elite tiers with telephony, advanced automations, multi-location, etc.‚Ä®
    * Usage engine tracks SMS, calls, AI tokens, email ‚Äî with clean transparent dashboards‚Ä®
    * Add-on marketplace for extras (gift cards, advanced analytics, extra numbers, etc.)‚Ä®
That‚Äôs the product story the new GPT should understand, not just ‚Äúmulti-tenant SaaS sandbox‚Äù.

1. Architecture Snapshot (Just Enough for Orientation)
* Backend: Node + Express + TypeScript, Drizzle + Postgres, Twilio, Google APIs‚Ä®
* Frontend: React + TS, TanStack Query, PWA‚Ä®
* Tenant isolation: wrapTenantDb pattern, tenant-scoped tables, tenant_domains‚Ä®
* Core modules:
    * CRM & Customers‚Ä®
    * Scheduling & Booking‚Ä®
    * Telephony & Messaging‚Ä®
    * Rewards & Referrals‚Ä®
    * Campaigns (Port Recovery, etc.)‚Ä®
    * Setup Wizard & Industry Packs‚Ä®
    * Usage/Billing‚Ä®
    * Technician Hub‚Ä®
    * Employee portal‚Ä®

2. Phase Index ‚Äî Your Existing MASTER PLAN v4.0 (Respected & Kept)
This is your Dec 6 list ‚Äî I‚Äôm not changing IDs, just adding a tiny bit of flavor.
üìû PHASE 1 ‚Äî TELEPHONY & COMMUNICATION (1.x)
1.1 ‚Äì Telephony Modes v1‚Ä®AI-first, Human-first, Hybrid, Text-only‚Ä®‚úî COMPLETE
1.2 ‚Äì A2P Assistant & Campaign Builder‚Ä®Regulatory helper, campaign templates, copy helper‚Ä®‚úî COMPLETE
1.3 ‚Äì A2P Auto-Submission + TrustHub Integration‚Ä®Automatic campaign registration flows‚Ä®‚úî COMPLETE
1.4 ‚Äì Trial Telephony Sandbox‚Ä®Test calls/SMS before connecting Twilio‚Ä®‚ö† PLANNED (SP-9)
1.5 ‚Äì Phone Inbox v2‚Ä®Improved layout, filtering, shortcuts, multi-channel view‚Ä®‚ö† PLANNED (SP-11)

üí∏ PHASE 2 ‚Äî BILLING & USAGE (2.x)
2.1 ‚Äì Usage Engine v1‚Ä®Track SMS / MMS / Voice / Email / AI Tokens‚Ä®‚úî COMPLETE (SP-3)
2.2 ‚Äì Tenant Usage Dashboard + System Usage (admin)‚Ä®Per-tenant and platform-wide usage transparency‚Ä®‚úî COMPLETE
2.3 ‚Äì Billing Automation v1 (Stripe)‚Ä®Recurring billing, overdue logic, dunning emails‚Ä®‚ö† THIS IS SP-6 (next after SP-5)
2.4 ‚Äì Add-On Marketplace‚Ä®Toggleable feature flags and upsells per tenant‚Ä®‚ö† PLANNED (SP-4)
2.5 ‚Äì Usage Transparency v2‚Ä®Drill-down costs by channel/vendor (Twilio, SendGrid, GPT)‚Ä®‚ö† PLANNED (SP-7)

üéÅ PHASE 3 ‚Äî LOYALTY & CUSTOMER ENGAGEMENT (3.x)
3.1 ‚Äì Loyalty v2‚Ä®Rewards portal, achievements, guardrails, booking integration‚Ä®‚úî COMPLETE
3.2 ‚Äì Referral Program v1‚Ä®QR codes, share links, track conversions, link to points‚Ä®‚ö† PLANNED (LL-3)
3.3 ‚Äì Gift Cards v1‚Ä®Holiday campaigns, Square integration, redemption flow‚Ä®‚úî PARTIAL ‚Äî CM-3 delivered campaign infra; redemption UX still needed
3.4 ‚Äì Identity Hardening v2‚Ä®OTP login for loyalty portal / secure claims‚Ä®‚ö† REVISIT LIST
3.5 ‚Äì Loyalty v3+‚Ä®Badges, streaks, timelines, leaderboards‚Ä®üåô FUTURE

üåê PHASE 4 ‚Äî PUBLIC SITE & MULTI-LANGUAGE (4.x)
4.1 ‚Äì Public Site v2‚Ä®Tenant-editable hero, colors, CTA, services, FAQ, etc.‚Ä®‚úî COMPLETE (CM-4)
4.2 ‚Äì Public Site v3‚Ä®Template library, theme presets, industry packs‚Ä®‚ö† PLANNED (SITE-2)
4.3 ‚Äì Full i18n System‚Ä®English/Spanish + hooks for others‚Ä®‚ö† PLANNED (SP-8 + LANG-1)
4.4 ‚Äì AI Site Generator‚Ä®Generate full website from tenant‚Äôs business profile‚Ä®üåô FUTURE

üß© PHASE 5 ‚Äî DASHBOARD UX, SIMPLE MODE, ADMIN (5.x)
5.1 ‚Äì Simple Mode vs Advanced Mode‚Ä®Beginner Mode (minimal settings) vs full-power view‚Ä®‚ö† PLANNED (SP-4)
5.2 ‚Äì Industry Pack Editor + Clone-a-Tenant Factory‚Ä®Turn Clean Machine + other setups into clonable presets‚Ä®‚ö† PLANNED (SP-10)
5.3 ‚Äì Support Center + AI Assistant v2‚Ä®Contextual help in every panel, integration with setup wizard‚Ä®‚úî SUPPORT v1 COMPLETE‚Ä®‚ö† AI Setup v2 PLANNED

‚öôÔ∏è PHASE 6 ‚Äî PERFORMANCE, OPS, SYSTEM HEALTH (6.x)
6.1 ‚Äì Bootstrap + Skeletons + Page Load Optimization‚Ä®First load UX, skeletons, initial responsiveness‚Ä®‚úî COMPLETE
6.2 ‚Äì Performance Pass v2‚Ä®Real profiling, SSR, caching, further DB query tuning‚Ä®‚ö† PLANNED (SP-12)
6.3 ‚Äì System Health Dashboard‚Ä®Errors, dropped calls, slow queries, job failures, Twilio issues‚Ä®üåô FUTURE

3. Functional Domains (What Exists + What‚Äôs Left)
This is the bridge between the product feel and the phase list.

3.1 Onboarding & Setup Wizard
What it does conceptually:
* Guides a new tenant from zero ‚Üí fully functional system:
    * Business info, branding, hours‚Ä®
    * Service area base address & radius‚Ä®
    * Services + pricing (or choose an industry pack)‚Ä®
    * Telephony connection (or sandbox mode)‚Ä®
    * A2P registration‚Ä®
    * SMS Parser / history import (for Clean Machine, later tenants too)‚Ä®
* Tries hard to make this ‚Äúone and done‚Äù for non-technical owners.‚Ä®
What‚Äôs already implemented:
* Setup pages and flows‚Ä®
* A2P helper & campaign builder‚Ä®
* Telephony connection flows (Twilio creds, numbers, etc.)‚Ä®
* Initial service area and scheduling settings‚Ä®
* Industry pack foundations (Clean Machine acts as first full pack)‚Ä®
Still needed / to emphasize in new chat:
* Finish the Square Setup Wizard (like Twilio wizard but for gift cards/payments)‚Ä®
* Fully wire the SMS Parser onboarding so future tenants:
    * Connect their existing phone logs‚Ä®
    * Get auto-built:
        * Service list‚Ä®
        * Common replies‚Ä®
        * Policy answers‚Ä®
        * FAQ‚Ä®
    * With almost no manual configuration‚Ä®
* Document & solidify the ‚Äúone-and-done‚Äù Setup Wizard as a crown jewel, not an afterthought.‚Ä®

3.2 CRM + Customer Database
Concept:
* A single customer profile:
    * Contact info (names, phones, emails)‚Ä®
    * Vehicles/properties‚Ä®
    * Conversation history (SMS, calls, web chat)‚Ä®
    * Bookings, cancellations, reschedules‚Ä®
    * Loyalty points and reward redemptions‚Ä®
    * Referral relationships‚Ä®
    * Gift card usage‚Ä®
* Auto-updated by:
    * SMS agent‚Ä®
    * Port recovery campaign‚Ä®
    * Parser imports‚Ä®
    * Booking flow‚Ä®
    * Technician actions‚Ä®
Current state:
* Customers table exists and is used‚Ä®
* Port Recovery now creates customer records where missing‚Ä®
* Points awarded and tracked‚Ä®
* Conversations linked‚Ä®
* Some records missing full data historically but we now have good forward behavior‚Ä®
Key future tasks:
* Customer merge tool (avoid dupes)‚Ä®
* Better email & phone enrichment from parser‚Ä®
* CRM UI: filters, tags, notes, intervals, VIP flagging‚Ä®

3.3 Scheduling, Maps & Service Area
What makes it special:
* Uses Google Maps travel time (not just radius) to:
    * Classify addresses‚Ä®
    * Optimize scheduling windows‚Ä®
    * Trigger extended-area workflows‚Ä®
* Designed to support weather-aware rescheduling later.‚Ä®
Already present / recently fixed:
* /api/geocode, /api/distance-check fixed‚Ä®
* IN_AREA, EXTENDED, OUT_OF_AREA, UNKNOWN classifications‚Ä®
* Timezone bug fixed in reminders‚Ä®
* Smart availability from Google Calendar integrated with:
    * Web chat (‚Äúhere‚Äôs times + booking link‚Äù)‚Ä®
    * Booking deep links (slotStart, focusDate)‚Ä®
Still to complete:
* Restore and fully wire:
    * AddressAutocomplete.tsx‚Ä®
    * AddressMapConfirmation.tsx‚Ä®
    * ServiceAreaCheck.tsx‚Ä®
    * travelTimeService.ts‚Ä®
* Extended-area map-pinning step and admin escalation panel.‚Ä®

3.4 Messaging, Telephony, & AI Agents
For owners:
* ‚ÄúPhone system + AI receptionist + SMS machine‚Äù in one place:
    * Handles:
        * Missed calls‚Ä®
        * After-hours‚Ä®
        * Quick scheduling‚Ä®
* Maintains personal feel (‚ÄúClean Machine voice‚Äù, or tenant‚Äôs voice)‚Ä®
Pieces in place:
* Twilio IVR, voicemail, transcription‚Ä®
* SMS AI agent with:
    * Real booking logic‚Ä®
    * Service area awareness‚Ä®
    * Pricing knowledge‚Ä®
* Web chat agent with:
    * Live times pulled from Google Calendar‚Ä®
    * Deep links into booking page‚Ä®
Fixes recently done:
* STOP compliance fixed‚Ä®
* Booking links now use tenant domain & correct route‚Ä®
* Messages page performance tuned (N+1 query fix, pagination defaults)‚Ä®
Still needed:
* Solid STOP/START logging & DNC panel‚Ä®
* Better agent instructions for:
    * Tone‚Ä®
    * When to show availability vs direct booking links‚Ä®
    * When to ask follow-up questions‚Ä®
* Telephony Setup Wizard drop-in for future tenants:
    * Softphone or direct-to-mobile options‚Ä®
    * Options A / B / C we discussed‚Ä®

3.5 Rewards, Referrals, Gift Cards
Big idea:
* Turn your whole base into a ‚Äúwe like coming back here‚Äù engine:
    * Points for campaigns, referrals, etc.‚Ä®
    * Gift cards as revenue now/booking later‚Ä®
    * Referral codes that feel easy to share and track‚Ä®
Clean Machine reality right now:
* Port Recovery campaign sent to 1900+ numbers‚Ä®
* 500 points granted where SMS delivered and backfill completed‚Ä®
* Personalized rewards landing page tokens‚Ä®
* Rewards landing page works; ‚ÄúBrowse services & pricing‚Äù CTA added‚Ä®
* Square integration partially wired for gift cards (needs full UX)‚Ä®
Still required:
* Ensure all recipients truly have 500 points & working links (should now be true, but new GPT should re-verify)‚Ä®
* Finish in-checkout gift card and points redemption flows (correct math, display clarity)‚Ä®
* Add Square Setup Wizard + multi-tenant mapping‚Ä®
* Global referral program v1 (Phase 3.2)‚Ä®

3.6 Technician Hub, Employee Portal, and Jobs Portal
Vision:
* Technician open app in morning ‚Üí sees:
    * Today‚Äôs jobs‚Ä®
    * Distances‚Ä®
    * ‚ÄúOn My Way‚Äù buttons‚Ä®
    * One-tap call or text customer‚Ä®
    * Quick notes‚Ä®
    * One-tap invoice / payment link‚Ä®
* Employee portal handles:
    * Onboarding new hires‚Ä®
    * Schedules (with request PTO, shift swaps)‚Ä®
    * Training resources‚Ä®
    * Access control‚Ä®
Current status:
* Tech pages exist (Schedule, Open Shifts, PTO, Shift Trades)‚Ä®
* They now share the AppShell & navigation correctly‚Ä®
* Under-the-hood employee scheduling logic exists‚Ä®
* Some components not fully integrated into the ‚ÄúOne Page for the Day‚Äù ideal‚Ä®
Future actions:
* Consolidate into a true Technician Hub page‚Ä®
* Integrate route optimization‚Ä®
* Integrate daily metrics + checklists‚Ä®
* Link to loyalty/gift card redemptions when relevant (e.g., free upgrades)‚Ä®
