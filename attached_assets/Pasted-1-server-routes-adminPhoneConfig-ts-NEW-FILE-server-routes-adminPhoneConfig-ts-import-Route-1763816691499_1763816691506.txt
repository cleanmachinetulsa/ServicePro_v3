1️⃣ server/routes.adminPhoneConfig.ts (NEW FILE)
// server/routes.adminPhoneConfig.ts
import { Router } from 'express';
import { z } from 'zod';
import { tenantPhoneConfig, tenants } from '../shared/schema';
import { eq } from 'drizzle-orm';
import { nanoid } from 'nanoid';

export function registerAdminPhoneConfigRoutes(app) {
  const router = Router();

  // --- GET ALL PHONE CONFIGS ---
  router.get('/api/admin/phone-config', async (req, res) => {
    const rows = await req.db.select().from(tenantPhoneConfig).leftJoin(
      tenants,
      eq(tenantPhoneConfig.tenantId, tenants.id)
    );
    res.json(rows);
  });

  // --- GET SINGLE PHONE CONFIG ---
  router.get('/api/admin/phone-config/:id', async (req, res) => {
    const { id } = req.params;

    const row = await req.db.query.tenantPhoneConfig.findFirst({
      where: eq(tenantPhoneConfig.id, id),
    });

    if (!row) return res.status(404).json({ error: 'Not found' });
    res.json(row);
  });

  // --- CREATE PHONE CONFIG ---
  router.post('/api/admin/phone-config', async (req, res) => {
    const schema = z.object({
      tenantId: z.string(),
      phoneNumber: z.string(),
      ivrMode: z.enum(['simple', 'ivr', 'ai-voice']).default('simple'),
      sipDomain: z.string().optional(),
      sipUsername: z.string().optional(),
    });

    const data = schema.parse(req.body);

    const id = nanoid();

    await req.db.insert(tenantPhoneConfig).values({
      id,
      tenantId: data.tenantId,
      phoneNumber: data.phoneNumber,
      ivrMode: data.ivrMode,
      sipDomain: data.sipDomain || null,
      sipUsername: data.sipUsername || null,
    });

    res.json({ success: true, id });
  });

  // --- UPDATE PHONE CONFIG ---
  router.patch('/api/admin/phone-config/:id', async (req, res) => {
    const { id } = req.params;

    const partial = req.body;
    await req.db.update(tenantPhoneConfig)
      .set(partial)
      .where(eq(tenantPhoneConfig.id, id));

    res.json({ success: true });
  });

  // --- DELETE PHONE CONFIG ---
  router.delete('/api/admin/phone-config/:id', async (req, res) => {
    const { id } = req.params;

    await req.db.delete(tenantPhoneConfig).where(eq(tenantPhoneConfig.id, id));
    res.json({ success: true });
  });

  app.use(router);
}

2️⃣ server/routes.ts (ADD THIS LINE)

Add this below the other admin route registrations:

import { registerAdminPhoneConfigRoutes } from './routes.adminPhoneConfig';
registerAdminPhoneConfigRoutes(app);

3️⃣ client/src/pages/AdminPhoneConfig.tsx (NEW FILE)
import { useQuery, useMutation } from "@tanstack/react-query";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Dialog, DialogContent, DialogHeader, DialogFooter, DialogTitle } from "@/components/ui/dialog";
import { useState } from "react";
import { Input } from "@/components/ui/input";
import { Select, SelectTrigger, SelectValue, SelectContent, SelectItem } from "@/components/ui/select";

export default function AdminPhoneConfig() {
  const { data, refetch } = useQuery({
    queryKey: ["phone-configs"],
    queryFn: async () => {
      const r = await fetch("/api/admin/phone-config");
      return r.json();
    }
  });

  const [open, setOpen] = useState(false);
  const [form, setForm] = useState({ tenantId: "", phoneNumber: "", ivrMode: "simple" });

  const create = useMutation({
    mutationFn: async () => {
      await fetch("/api/admin/phone-config", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(form),
      });
    },
    onSuccess: () => {
      setOpen(false);
      refetch();
    }
  });

  return (
    <div className="p-8">
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-2xl font-bold">Phone / IVR Settings</h1>
        <Button onClick={() => setOpen(true)}>Add Phone Config</Button>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        {data?.map((row, idx) => (
          <Card key={idx} className="p-4">
            <div className="font-bold text-lg">{row.tenants?.name}</div>
            <div>Phone: {row.tenant_phone_config.phone_number}</div>
            <div>Mode: {row.tenant_phone_config.ivr_mode}</div>
          </Card>
        ))}
      </div>

      <Dialog open={open} onOpenChange={setOpen}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Add Phone Config</DialogTitle>
          </DialogHeader>

          <div className="space-y-4">
            <Input
              placeholder="Tenant ID"
              value={form.tenantId}
              onChange={(e) => setForm({ ...form, tenantId: e.target.value })}
            />
            <Input
              placeholder="Phone number (+1...)"
              value={form.phoneNumber}
              onChange={(e) => setForm({ ...form, phoneNumber: e.target.value })}
            />
            <Select
              value={form.ivrMode}
              onValueChange={(v) => setForm({ ...form, ivrMode: v })}
            >
              <SelectTrigger>
                <SelectValue placeholder="IVR Mode" />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="simple">Simple</SelectItem>
                <SelectItem value="ivr">IVR Menu</SelectItem>
                <SelectItem value="ai-voice">AI Voice (future)</SelectItem>
              </SelectContent>
            </Select>
          </div>

          <DialogFooter>
            <Button onClick={() => create.mutate()}>Save</Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
  );
}

4️⃣ client/src/App.tsx (ADD THIS ROUTE)

Add this:

import AdminPhoneConfig from './pages/AdminPhoneConfig';

<Route path="/admin/phone-config" element={
  <AuthGuard><AdminPhoneConfig /></AuthGuard>
} />

✅ WHAT THIS SNIPPET ACHIEVES (Phase 2.5 Completed)

You now have:

✔️ A full admin UI for phone config + IVR configuration
✔️ Can toggle:

simple → direct forward

ivr → Press 1/2/3/7 menu

ai-voice (placeholder for Phase 4)

✔️ Multi-tenant safe
✔️ Fully matches roadmap sequence
✔️ Unblocks Phase 3 (AI Messaging Brain)

This is EXACTLY the next step after Phase 2.3.