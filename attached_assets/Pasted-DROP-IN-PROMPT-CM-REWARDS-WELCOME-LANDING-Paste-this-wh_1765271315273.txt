DROP-IN PROMPT: CM-REWARDS-WELCOME-LANDING

Paste this whole thing into Replit Architect for the ServicePro_v3 repo.
You are modifying the Clean Machine (root tenant) experience.
Do not break:

Existing rewards portal v2

Booking flows

SMS campaigns, including the Welcome Back / missed-call ones

Root tenant routing and domain logic
Only change files that are necessary for this feature.

0. Goal

Create a â€œPoints Welcomeâ€ landing flow for customers who tap the SMS link that says:

â€œSorry I missed your messageâ€¦ here are 500 bonus pointsâ€¦â€

When they hit the link, we want:

A tight, beautiful, animated landing screen that:

Greets them by name

Celebrates their points with confetti / motion

Shows current balance + what those points can buy

Has a Book Now button that goes straight into booking

Gently mentions holiday gift cards

Shows a small floating chat bubble (minimized by default, labelled so they know itâ€™s chat)

This page should feel connected to the current Clean Machine site, but slightly more â€œpremiumâ€ and celebratory.

It should plug into the existing loyalty/rewards portal and use the same underlying APIs & token mechanics. No reinventing auth.

Name this feature CM-REWARDS-WELCOME-LANDING in comments/docs.

1. Discover existing rewards portal + APIs

First, scan the repo to understand current rewards plumbing:

Find the customer-facing rewards portal (v2) by searching for:

"Rewards Portal", "Loyalty Portal", "points balance", "redeem points" or similar.

Likely files:

client/src/pages/rewards/RewardsPortalPage*.tsx

client/src/components/rewards/*

server/routes.rewards*.ts

Find the API endpoint that powers the portal:

Example patterns: /api/rewards/portal/*, /api/rewards/summary, /api/rewards/customer/:token, etc.

Identify how customer tokens are passed in from SMS links:

Query param (?token=) vs path (/rewards/portal/:token).

Do not change the existing rewards portal behavior. Weâ€™re going to add a new landing page that reuses the same APIs.

2. New Page: Points Welcome Landing

Create a new page:

File: client/src/pages/rewards/PointsWelcomeLandingPage.tsx

Route: /rewards/welcome (client-side)

It should accept the same customer token mechanism as the existing portal:

If the portal uses ?token=, this page also reads from ?token=.

If it uses /rewards/portal/:token, then this page should work with /rewards/welcome/:token.

Reuse whatever helper/hook currently loads the customer + points for the portal.

2.1. Data & hooks

In PointsWelcomeLandingPage:

Reuse existing hook/service to load the current customer & points:

If thereâ€™s a hook like useRewardsPortal(token) or useRewardsSummary, use that.

Data we want:

Customer first name (or fallback to â€œthereâ€)

Current points balance

Rewards catalog (rewards with point cost + description)

Handle loading & error states:

Loading: show a short branded skeleton (logo, â€œLoading your pointsâ€¦â€).

Error: show a friendly message and a â€œTry againâ€ button, not raw errors.

2.2. Visual + layout

Use the existing UI system:

Card, Button, Badge, Avatar, Separator, Tabs, Carousel (if you have a gallery/carousel component), etc. from @/components/ui/...

Tailwind and motion/animation conventions already in the project.

Layout (desktop):

Full-height, centered content, single screen (no scroll if possible on desktop).

2-column layout on md+:

Left column: celebration & copy

Right column: points card + reward highlights

Mobile: stack vertically with top as celebration card.

Key UI pieces:

Celebration header

Gradient background card with subtle motion and confetti.

Use framer-motion if already used in the project (if not, a small fade/scale animation is fine).

Copy (you can hard-code these strings; see copy section below):

Headline:
"Hey {firstName}, your Clean Machine points are live ğŸ‰"

Subheadline:
"We dropped bonus points into your account as a thank-you for your patience while we upgraded our phone system."

Show a big points number with a badge:

Example:
"Current balance: 750 points"
Badge under it: "Worth up to $XX off your next detail" (if you can derive an approximate value from existing reward tiers; otherwise just show â€œReady to redeemâ€ type language).

Reward highlights

In the right column, a â€œWhat your points can doâ€ card:

Show 3â€“4 rewards pulled from the existing catalog, sorted by lowest point cost first.

For each, show:

Reward name

Points required

Short description

Add a subtle progress indicator for â€œnext rewardâ€ if easy:

progress = points / nearestRewardPoints.

Call-to-action row

Below the celebration copy, big buttons:

Primary CTA: â€œBook a Detail with My Pointsâ€

This should link to the existing booking flow used elsewhere for Clean Machine.

Reuse existing booking URL (whatever the main â€œBook Nowâ€ button uses on the home/rewards portal, e.g. /book, /book/cleanmachine, etc.).

Secondary link/button: â€œBrowse all rewardsâ€

Link to the main rewards portal page (same one used everywhere for points management).

Holiday Gift Card mention

In the lower part of the page, short card or text block:

Title: "Gift cards make ridiculously easy holiday wins ğŸ"

Copy (see copy section).

Button or link: â€œGet a gift cardâ€ linking to your existing gift card URL if one exists (or stub to /gift-cards if present in the app).

Dynamic photo strip / carousel

Find your existing gallery / hero photos for Clean Machine (whatever the home page uses).

Reuse them as:

Either a soft-scrolling strip of recent detail photos.

Or a small carousel with auto-advance and dots.

This is purely visualâ€”no need for the â€œrefresh layoutâ€ button in v1 if thatâ€™s heavy. (If itâ€™s trivial to add a â€œshuffle photosâ€ button that just randomizes order client-side, thatâ€™s fine.)

2.3. Chat bubble

Reuse any existing chat component if available:

Search for ChatWidget, ChatBubble, SupportChat, etc.

If none exists, create a small floating button component:

File: client/src/components/chat/FloatingChatButton.tsx (or similar).

Fixed bottom-right on the page.

Circular button with message icon and a tiny label:

On desktop: show icon + â€œChatâ€ label (Chat so they clearly know what it is).

On mobile: icon only, but include aria-label="Chat with us" and a tooltip-like hover/press text if you have a tooltip system.

Behavior:

Default state: minimized.

Clicking opens your existing chat widget / support assistant panel:

If thereâ€™s a page-level chat, call its open() function or set a local state to show a slide-over.

This bubble should not cover the main CTAs.

3. Copy (you can hard-code these strings)

Please use copy similar to this, adjusting slightly to fit existing i18n/patterns:

Hero headline:

â€œHey {firstName}, your Clean Machine points are live ğŸ‰â€

Subheadline:

â€œWeâ€™ve been upgrading our phone system behind the scenes, and a few calls slipped through the cracks. To make it up to you, we loaded bonus loyalty points into your account so your next detail is easier to say yes to.â€

Points explanation block:

â€œEvery time you book with us, you earn points that stack toward free upgrades and discounted details. These bonus points are our way of saying thanks for your patienceâ€”and for being the kind of customer we never want to lose.â€

CTA text under buttons:

â€œGrab a spot on the schedule now and weâ€™ll automatically apply your points at the time of service.â€

Gift card block:

Title:

â€œPerfect time for gift cards ğŸâ€

Body:

â€œIf youâ€™ve got a car-lover, busy parent, or road warrior in your life, a Clean Machine gift card is a ridiculously easy win. You tap a few buttons, they get a spotless car and all the credit goes to you.â€

Button (if gift card URL exists):

â€œGet a gift cardâ€

Chat helper hint:

â€œQuestions about your points or booking? Tap the chat bubble and weâ€™ll help you out.â€

4. Routing & link from SMS campaigns (no breaking changes)

Do not override existing database SMS templates.

Instead:

Make sure the new page can be linked as:

https://cleanmachinetulsa.com/rewards/welcome?token=<customerToken>
OR (if current portal uses path params)

https://cleanmachinetulsa.com/rewards/welcome/<customerToken>

Update documentation and comments to clearly state the desired link format so the operator (Jody) can paste that into the campaign templates.

Do NOT auto-change the stored SMS templates in the DB. Just make it possible to point them at this route.

5. Security & tenant behavior

Assume this is currently only for the Clean Machine (root) tenant, but:

Keep the code tenant-safe: use existing helpers that bind the rewards API calls to the current tenant.

If a token is invalid / expired:

Show a gentle message:

â€œThis link has expired or is already used. Tap the chat bubble or text us and weâ€™ll resend your points link.â€

6. Tests & docs

Add basic e2e test or Playwright scenario if you already use them:

Visit /rewards/welcome with a valid test token.

Assert:

The greeting text renders.

Points balance appears.

Book Now button exists.

Update replit.md or your main plan doc with a section:

CM-REWARDS-WELCOME-LANDING

Routes, main components, and how to build the SMS link.

End of drop-in. Please implement exactly as described, preserving existing rewards & booking behavior.

SMS COPY for your â€œSorry I missed you + 500 pointsâ€ campaign

Youâ€™ll paste this yourself into the campaign template (so we donâ€™t stomp anything in the DB):

Subject / label (internal):
Missed call apology + 500 bonus points

SMS body (for regular customers):

Hey {first_name}, itâ€™s Jody at Clean Machine Auto Detail ğŸ§¼

Iâ€™ve been upgrading my phone system and a few calls / messages slipped through the cracks ğŸ˜” Thatâ€™s on me.

To say thanks for your patience, I just dropped 500 loyalty points into your account (good toward upgrades and discounts on your next detail).

Tap here to see your points and grab a spot on the schedule: {short_link_to_rew_welcome}

If you have questions, you can also chat with me right from that page.

VIP version (if you want one):

Hey {first_name}, itâ€™s Jody at Clean Machine ğŸ‘‹

Youâ€™re one of my favorite regulars, and I hate that my phone upgrades caused me to miss you. So I added 1,000 loyalty points to your account as a thank-you.

Tap here to see your points, check what they can get you, and grab your next detail: {short_link_to_rew_welcome}

Where {short_link_to_rew_welcome} is your new page, e.g.:

https://cleanmachinetulsa.com/rewards/welcome?token={customer_token}