ğŸ§± DROP-IN PROMPT: Customer Rewards Portal V2 (Loyalty Journey Polish)

Paste everything below into the Replit agent as a single message:

You are working in the ServicePro v3 multi-tenant SaaS repo (Clean Machine is the root tenant).

Your task in this block is to refine the existing customer-facing loyalty / rewards experience into a premium â€œCustomer Rewards Portal v2â€ â€” not to rebuild from scratch.

We already have:

A page where customers enter their phone number to see loyalty points

A page showing rewards / checkpoints / badges / milestones

Loyalty data in the backend (points, reward rules, history, etc.)

You must:

Find and reuse these existing pages and APIs

Upgrade the UX / UI / copy / flow, not rip out working logic

Keep everything multi-tenant-safe (tenant isolation, no cross-tenant leaks)

1. Discovery (DO NOT SKIP)

Search the repo for existing loyalty / rewards features:

Look for routes / pages / components with names like:

Loyalty, Rewards, Points, Badges, Milestones, Checkpoints

Paths like /rewards, /loyalty, /customer/rewards, /customer/points, /portal

Search terms:

"loyalty", "rewardPoints", "pointsBalance", "checkpoints", "badges", "milestone"

"CustomerRewards", "RewardsPage", "LoyaltyPage", "RewardsPortal", "PointsLookup"

Identify:

Customer-facing routes (public or semi-public), e.g.:

GET /rewards

GET /customer/rewards

APIs used by those pages, e.g.:

GET /api/public/loyalty/...

POST /api/public/loyalty/lookup (phoneâ†’points)

Any existing components like:

Phone lookup form

Reward list / catalog

Milestone / badge display

Summarize (in comments in the code) what currently exists:

Where the main customer points lookup page is

Where the rewards catalog is

Where the milestone / badge display is

Which endpoints they call and what shape the data has

Important: we already know there is a phone-based lookup & rewards page â€” do not assume theyâ€™re missing just because theyâ€™re a bit ugly. Find them and build on top.

2. Design Goals â€“ â€œCustomer Rewards Portal v2â€

Weâ€™re not changing the business logic or the points math here.
Weâ€™re upgrading UX, aesthetics, and the customer journey.

2.1. Overall Experience

We want a single, canonical, customer-facing Rewards Portal page that:

Is mobile-first and looks premium, not â€œMVP dev UIâ€

Uses the existing data & APIs

Makes a great first impression (most customers will see this before anything else)

Conceptual flow:

Customer taps a link (from SMS/email/site) to open the Rewards Portal

They enter their phone number

They see:

Their current points balance

Next reward milestones and progress toward them

A catalog of rewards they can redeem, with clear labels:

â€œAvailable nowâ€

â€œX points awayâ€

Any earned badges / checkpoints (e.g. â€œ3rd detail completedâ€, â€œVIPâ€, etc.)

They understand:

What they can get now

What theyâ€™re close to unlocking

How to redeem (high-level; underlying redemption logic already exists)

3. Customer Rewards Portal â€“ Implementation Details
3.1 Route / Entry Point

Choose a single canonical route for the customer rewards portal, e.g.:

/rewards or /portal/rewards (use whichever already exists; if both exist, consolidate to one canonical and keep the other as a redirect)

Ensure:

It does not require tenant admin login

It still remains tenant-scoped:

Either via root tenant with a â€œbrandâ€ / site config

Or via subdomain / path mapping (whatever the app already uses)

This portal should be the primary link for:

SMS campaigns (Port Recovery, winback, etc.)

Email campaigns related to loyalty

Any â€œView your rewardsâ€ link on the public website

3.2 States & Layout

Implement (or refactor to) three clear states:

State A â€“ Phone lookup (no customer selected yet)

Big, friendly hero:

Title: â€œCheck your Clean Machine Rewardsâ€

Subtitle: â€œEnter your mobile number to see your points, perks, and rewards.â€

Phone number input:

Single field, with basic validation

E164 formatting helper if we have a utility for that; otherwise keep validation forgiving

CTA button: â€œShow My Rewardsâ€

Subtle note: â€œWeâ€™ll never spam you. This just finds your existing account.â€

State B â€“ Customer found / points loaded

Top â€œbalanceâ€ card:

Shows:

Customer name (if available) or â€œHey there!â€ / â€œValued Customerâ€

Current points balance (big and readable)

Small text: â€œEarn points every time you book with Clean Machine Auto Detail.â€

Milestones / checkpoints strip:

Horizontal or vertical progress view that:

Shows the next 2â€“3 meaningful milestones (e.g. 500 pts, 1000 pts, etc.)

For each:

Title (e.g. â€œFree Upholstery Protectorâ€)

Required points

Progress (e.g. â€œ350 / 500 pointsâ€ with a small progress bar)

If there are â€œbadgesâ€ that already exist in the code, surface them here:

e.g. â€œ3rd Detail Badgeâ€, â€œInterior Specialistâ€, etc.

Rewards catalog section:

Grid/list of rewards with cards:

Reward name

Points cost

Short description (â€œUse on your next full detailâ€, etc.)

Status chip:

â€œAvailable nowâ€ (if balance meets points & passes guardrails)

â€œX points awayâ€ otherwise

If guardrails prevent redemption (min cart total, require core service), show:

A small helper text like:

â€œRedeemable when you book a core service (Interior/Exterior Detail)â€

Use the loyalty_guardrail_message if configured.

How to redeem info:

Simple explanatory block:

e.g. â€œTo redeem, just mention your reward when booking, or choose it in the booking form. Weâ€™ll confirm final eligibility at checkout.â€

State C â€“ No customer found / error

If the phone number lookup returns no match:

Show a friendly message:

â€œWe couldnâ€™t find any rewards for that number yet.â€

â€œIf youâ€™ve used Clean Machine before, make sure you typed the same number you text with us.â€

Optionally: suggest booking a service to start earning.

3.3. Data Wiring

Do NOT invent new APIs if there are already ones for loyalty lookup / rewards.
Prefer reusing:

Existing â€œphone â†’ pointsâ€ lookup endpoint.

Existing â€œget rewards / checkpoints / milestonesâ€ endpoint.

Only if absolutely necessary:

Add lightweight read-only endpoints, like:

GET /api/public/loyalty/summary?phone=...

These should:

Use proper tenant isolation (use wrapTenantDb)

Never expose other tenantsâ€™ data

If there are multiple overlapping endpoints:

Standardize internally, but keep backward compatible responses if other parts of the app call them.

4. Visual / UX Quality

This should look and feel like v2 / v3, not like a bootstrap demo.

Guidelines:

Mobile-first:

Cards stacked vertically on small screens

Reasonable padding and font sizes

Use existing design language:

Same fonts, radius, shadow, gradient language used on newer pages (Setup Wizard, modern admin cards, etc.)

Donâ€™t overcomplicate:

3â€“4 main sections:

Hero + lookup (or greeting)

Points balance + milestones

Rewards catalog

How-to-redeem note

Microcopy:

Keep tone friendly and non-robotic.

Example texts are fine, but keep them generic enough to work for any tenant, not just Clean Machine (e.g. refer to {businessName} or use tenant branding where already available).

5. Journey Integration & Links

Once the portal is polished:

Tie it into campaigns that mention points, especially:

Port Recovery campaign messages

Any apology/winback messaging that says â€œyou have 500 free pointsâ€

For Port Recovery template specifically (if safe to edit):

Ensure the sample SMS includes the canonical Rewards Portal URL (e.g. {{rewardsPortalUrl}}).

Keep logic multi-tenant-safe:

Rewards link built using the tenantâ€™s domain / subdomain config if available.

Ensure the public Clean Machine site (or tenant sites) include a â€œRewardsâ€ link in a sensible place:

Navbar, footer, or a dedicated CTA card on the homepage that points to the portal route.

6. Multi-Tenant & Safety Requirements

All new or refactored APIs must:

Use wrapTenantDb or the existing per-tenant DB helper.

Never access another tenantâ€™s loyalty data.

The customer-facing portal:

Should be brand-aware (use tenant logo/name if thatâ€™s already available in the global public site config).

Must not leak internal admin details (no admin-only fields, no raw IDs that shouldnâ€™t be public).

Do not introduce any breaking changes to:

Admin loyalty screens

Existing loyalty redemption logic

Existing points ledger mechanics

We are only:

Improving UI/UX

Tightening the customer-facing flow

Wiring canonical links for campaigns

7. Testing & Sanity Checks

Add or update tests as appropriate:

At least one integration or unit test for the phone lookup + rewards summary handler (if touched).

Frontend:

Verify the portal can:

Render with no phone entered

Render a â€œcustomer foundâ€ state from mocked API

Render a â€œno customer foundâ€ state

Manual sanity checklist (please run):

Open the Rewards Portal route on localhost:

See the phone-lookup state.

Enter a known test customer phone that has points:

See balance, milestones, rewards list.

Enter a bogus phone:

See polite â€œno rewards yetâ€ state.

Verify Port Recovery preview still works and references are not broken.

Verify nothing breaks on the admin side (dashboard loads, loyalty features still work).

When done, leave a short code comment at the top of the main Rewards Portal component explaining:

That this is â€œCustomer Rewards Portal v2â€

That it builds on existing loyalty APIs

That itâ€™s intended as the primary entry point for customers to see their points & rewards